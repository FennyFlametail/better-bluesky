/* ==UserStyle==
@name           Better Bluesky
@namespace      https://bsky.app/profile/fenny.zone
@version        2025-12-16
@description    by @fenny.zone on Bluesky. Loosely based on the "blue blue sky" Arc boost by @twobabyteeth on Twitter.
@author         https://bsky.app/profile/fenny.zone
@supportURL     https://bsky.app/profile/fenny.zone
@license        MIT
@match          https://*.bsky.app/*

@var select tweak-option-use-title "Use title emoji" {
  "yes:Yes": "none",
  "no:No": "0px"
}
@var text tweak-option-title "Title emoji (in quotes)" "'☁️'"
@var text tweak-option-font "Font family" "'Avenir Next', 'SF Pro Rounded', ui-rounded, system-ui;"
@var number tweak-option-line-height "Line height" [1.3, null, null, 0.05]
@var select tweak-option-text-transform "Text transform" {
  "none:None": "revert",
  "lowercase:lowercase": "lowercase",
  "uppercase:UPPERCASE": "uppercase"
}
@var select tweak-option-disable-text-outlines "Disable focus outlines on text fields" {
  "yes:Yes": "none",
  "no:No": "1px auto"
}
@var select tweak-option-small-link-previews "Small link previews (Chrome/Safari only)" {
  "yes:Yes": "yes",
  "no:No*": "no"
}
@var color tweak-option-bg "Light mode background" #f9f3ec
@var color tweak-option-accent "Light mode accent (contrast with background)" #388098
@var color tweak-option-text "Light mode text (contrast with background)" #9e5574
@var color tweak-option-danger "Light mode destructive actions (contrast with background)" #c6262e
@var color tweak-option-bg-dark "Dark mode background" #222232
@var color tweak-option-accent-dark "Dark mode accent" #f48da4
@var color tweak-option-text-dark "Dark mode text" #8fc7e8
@var color tweak-option-danger-dark "Dark mode destructive actions" #ed5353
==/UserStyle== */

/* To install using Userscripts for iOS/Mac:
    1. Customize the :root block below with your desired options.
    2. Delete the @-moz-document line, and the final line (the lone "}").
    3. Paste the :root block below the long line with all the code.

    When the theme updates, repeat steps 2 and 3.

:root {
    --tweak-option-use-title: none;
    --tweak-option-title: '☁️';
    --tweak-option-font: 'Avenir Next', 'SF Pro Rounded', ui-rounded, system-ui;
    --tweak-option-line-height: 1.3;
    --tweak-option-text-transform: revert;
    --tweak-option-disable-text-outlines: none;
    --tweak-option-small-link-previews: no;

    --tweak-option-accent: #388098;
    --tweak-option-bg: #f9f3ec;
    --tweak-option-text: #9e5574;

    --tweak-option-accent-dark: #f48da4;
    --tweak-option-bg-dark: #222232;
    --tweak-option-text-dark: #8fc7e8;
}

/instructions */

/*
Section headings (use Cmd-F to navigate)
!GENERAL
!CONTROLS
!LAYOUT
!FEED
!POSTS
!CONTEXT MENUS
!MODALS
!POST COMPOSER
!IMAGES & VIDEO
!NOTIFICATIONS
!PROFILE
!CHATS
!SETTINGS
*/

@-moz-document domain("bsky.app") {
    @keyframes fade-in {
        from {
            opacity: 0; 
        }
        to {
            opacity: 1;
        }
    }
    @keyframes scale-up {
        from {
            transform: scale(0);
        }
        to {
            transform: scale(1);
        }
    }

    /* ----- !GENERAL ----- */

    :root,
    :root.theme--light,
    :root.theme--dim {
        --tweak-accent: var(--tweak-option-accent, #388098);
        --tweak-bg: var(--tweak-option-bg, #f9f3ec);
        --tweak-fg: var(--tweak-option-text, #9e5574);
        --tweak-danger: var(--tweak-option-danger, #c6262e);

        --tweak-bg-secondary: color-mix(in srgb, var(--tweak-bg) 90%, black);
        --tweak-bg-tertiary: color-mix(in srgb, var(--tweak-bg) 75%, black);
        --tweak-bg-translucent: color-mix(in srgb, var(--tweak-bg) 75%, transparent);
        --tweak-fg-translucent: color-mix(in srgb, var(--tweak-fg) 75%, transparent);
        --tweak-fg-more-translucent: color-mix(in srgb, var(--tweak-fg) 25%, transparent);
        --tweak-accent-darker: color-mix(in srgb, var(--tweak-accent) 80%, black);
        --tweak-accent-translucent: color-mix(in srgb, var(--tweak-accent) 50%, transparent);
        --tweak-accent-more-translucent: color-mix(in srgb, var(--tweak-accent) 25%, transparent);
        --tweak-danger-darker: color-mix(in srgb, var(--tweak-danger) 80%, black);

        --tweak-radius: 14px;
        --tweak-blur: blur(30px);
        --tweak-shadow: rgba(0, 0, 0, 0.3) 0px 5px 20px;
        --tweak-transition-properties: background, border-color;
        --tweak-transition-timing: 100ms ease;

        --background: var(--tweak-bg) !important;
        --backgroundLight: var(--tweak-bg) !important;
        --text: var(--tweak-fg) !important;
        background-color: var(--tweak-bg) !important;
    }

    :root.theme--dim {
        --tweak-accent: var(--tweak-option-accent-dark, #f48da4);
        --tweak-bg: var(--tweak-option-bg-dark, #222232);
        --tweak-fg: var(--tweak-option-text-dark, #8fc7e8);
        --tweak-danger: var(--tweak-option-danger-dark, #ed5353);

        --tweak-bg-secondary: color-mix(in srgb, var(--tweak-bg) 90%, white);
        --tweak-bg-tertiary: color-mix(in srgb, var(--tweak-bg) 75%, white);
    }

    :root.theme--dark body::after {
        position: fixed;
        top: 0;
        left: 0;
        background: var(--tweak-option-bg-dark);
        width: 100vw;
        content: 'To use Better Bluesky, set your dark theme to "Dim" in Settings > Appearance!';
        color: var(--tweak-option-text-dark);
        text-align: center;
    }

    * {
        border: 0px solid var(--tweak-fg-more-translucent) !important;
        transition: var(--tweak-transition-timing);
        transition-property: var(--tweak-transition-properties);
        text-decoration-color: currentColor !important;
        -webkit-font-smoothing: auto;
    }
    *:focus {
        outline: none;
    }
    *:focus-visible {
        outline: 1px auto;
    }
    *:is(input, textarea, .ProseMirror):focus-visible {
        outline: var(--tweak-option-disable-text-outlines, none);
    }
    *:not(input, textarea, .ProseMirror) {
        text-transform: var(--tweak-option-text-transform, 'lowercase');
    }

    *:not(.material-symbols-outlined, .material-icons) {
        line-height: var(--tweak-option-line-height, 1.3) !important;
        font-family: var( --tweak-option-font, 'Avenir Next', 'SF Pro Rounded', ui-rounded, system-ui) !important;
    }
    *::selection {
        background-color: var(--tweak-fg-more-translucent);
    }

    path[fill] {
        fill: var(--tweak-fg) !important;
    }

    /* common colors in light mode */
    :where(:root.theme--light) {
        /* nav item, hovered tab, hovered hamburger menu item background */
        [style*="background-color: rgb(249, 250, 251)"] {
            background-color: var(--tweak-bg-secondary) !important;
        }

        /* active tab indicator and tablet/desktop unread chat badge */
        div[style*="background-color: rgb(0, 106, 255)"] {
            background-color: var(--tweak-accent) !important;
        }

        /* various screen backgrounds */
        div[style*="background-color: rgb(255, 255, 255)"] {
            background-color: var(--tweak-bg) !important;
        }

        /* primary text */
        [style*="color: rgb(0, 0, 0)"] {
            color: var(--tweak-fg) !important;
        }

        /* secondary dimmed text */
        [style*="color: rgb(64, 81, 104)"],
        /* reply post and content warning Show text */
        [style*="color: rgb(35, 46, 62)"] {
            color: var(--tweak-fg-translucent) !important;
        }

        :is(
            /* link text */
            a, span,
            /* ex. language button on post composer */
            button > div
        )[style*="color: rgb(0, 106, 255)"] {
            color: var(--tweak-accent) !important;
        }

        /* destructive action text */
        [style*="color: rgb(233, 22, 70)"] {
            color: var(--tweak-danger) !important;
        }
        /* destructive action icons */
        path[fill="#E91646"] {
            fill: var(--tweak-danger) !important;
        }
    }

    /* common colors in dark mode */
    :where(:root.theme--dim) {
        /* nav item, hovered tab, hovered hamburger menu item background */
        [style*="background-color: rgb(28, 39, 54)"] {
            background-color: var(--tweak-bg-secondary) !important;
        }

        /* active tab indicator and tablet/desktop unread chat badge */
        div[style*="background-color: rgb(15, 115, 255)"] {
            background-color: var(--tweak-accent) !important;
        }

        /* various screen backgrounds */
        div[style*="background-color: rgb(21, 29, 40)"] {
            background-color: var(--tweak-bg) !important;
        }

        /* primary text */
        [style*="color: rgb(255, 255, 255)"] {
            color: var(--tweak-fg) !important;
        }

        /* secondary dimmed text */
        [style*="color: rgb(171, 184, 201)"],
        /* reply post and content warning Show text */
        [style*="color: rgb(226, 231, 238)"] {
            color: var(--tweak-fg-translucent) !important;
        }

        :is(
            /* link text */
            a, span,
            /* ex. language button on post composer */
            button > div
        )[style*="color: rgb(15, 115, 255)"] {
            color: var(--tweak-accent) !important;
        }
        
        /* destructive action text */
        [style*="color: rgb(235, 36, 82)"] {
            color: var(--tweak-danger) !important;
        }
        /* destructive action icons */
        path[fill="#EB2452"] {
            fill: var(--tweak-danger) !important;
        }
    }

    /* ----- !CONTROLS ----- */

    /* text fields */
    input + div,
    /* alt text box */
    textarea + div,
    /* "Write your reply" fake text box at bottom of posts */
    button[aria-label="Compose reply"] {
        background: var(--tweak-fg-more-translucent) !important;
    }

    input::placeholder,
    textarea::placeholder,
    p[data-placeholder]::before {
        color: var(--tweak-fg-translucent) !important;
    }

    textarea {
        resize: vertical !important;
    }

    /* blue roundrect buttons */
    :root.theme--light button[style*="background-color: rgb(0, 106, 255)"],
    :root.theme--dim button[style*="background-color: rgb(15, 115, 255)"] {
        background-color: var(--tweak-fg) !important;
        transition-property: var(--tweak-transition-properties), transform;

        div {
            color: var(--tweak-bg) !important;
        }

        path:not([data-testid="composeFAB"] path) {
            fill: var(--tweak-bg) !important;
        }
    }
    /* blue roundrect button hover */
    :root.theme--light button[style*="background-color: rgb(0, 89, 214)"],
    :root.theme--dim button[style*="background-color: rgb(77, 151, 255)"] {
        background-color: var(--tweak-accent) !important;
        transition-property: var(--tweak-transition-properties), transform;

        &:active {
            transform: scale(0.9);
        }

        div {
            color: var(--tweak-bg) !important;
        }

        path {
            fill: var(--tweak-bg) !important;
        }
    }

    /* destructive buttons */
    :root.theme--light button[style*="background-color: rgb(233, 22, 70)"],
    :root.theme--dim button[style*="background-color: rgb(235, 36, 82)"] {
        background-color: var(--tweak-danger) !important;
        transition-property: var(--tweak-transition-properties), transform;

        &:active {
            transform: scale(0.9);
        }

        div {
            color: var(--tweak-bg) !important;
        }

        path {
            fill: var(--tweak-bg) !important;
        }
    }
    /* destructive buttons hover */
    :root.theme--light button[style*="background-color: rgb(202, 18, 61)"],
    :root.theme--dim button[style*="background-color: rgb(247, 100, 134)"] {
        background-color: var(--tweak-danger-darker) !important;
        transition-property: var(--tweak-transition-properties), transform;

        &:active {
            transform: scale(0.9);
        }

        div {
            color: var(--tweak-bg) !important;
        }

        path {
            fill: var(--tweak-bg) !important;
        }
    }

    /* buttons with gradient backgrounds (ex. compose FAB) */
    div[style*="background-image: linear-gradient"][style*="rgb(90, 113, 250)"] {
        background: var(--tweak-accent) !important;
        transition-property: var(--tweak-transition-properties), transform;

        &:hover, &:active {
            background: var(--tweak-accent-darker) !important;
        }

        /* make the press animation more prominent */
        &:active {
            transform: scale(0.9);
        }

        > div {
            color: var(--tweak-bg) !important;
        }
    }

    /* white/black buttons */
    /* :not(:hover) is because non-hovered profile buttons are the same color as hovered top bar buttons */
    /* top bar buttons */
    :root.theme--light :is(a, button)[style*="background-color: rgb(255, 255, 255)"]:not(:hover),
    :root.theme--dim :is(a, button)[style*="background-color: rgb(21, 29, 40)"]:not(:hover),
    /* profile buttons */
    :root.theme--light :is(a, button)[style*="background-color: rgb(239, 242, 246)"]:not(:hover),
    :root.theme--dim :is(a, button)[style*="background-color: rgb(34, 46, 63)"]:not(:hover) {
        background-color: var(--tweak-bg-secondary) !important;
        transition-property: var(--tweak-transition-properties), transform;

        &:active {
            transform: scale(0.9);
        }

        /* icon-only buttons */
        &:has(svg):not(:has(div)) {
            background-color: transparent !important;
        }
    }
    /* white/black buttons hover */
    /* top bar buttons */
    :root.theme--light :is(a, button)[style*="background-color: rgb(239, 242, 246)"],
    :root.theme--dim :is(a, button)[style*="background-color: rgb(34, 46, 63)"],
    /* profile buttons */
    :root.theme--light :is(a, button)[style*="background-color: rgb(220, 226, 234)"],
    :root.theme--dim :is(a, button)[style*="background-color: rgb(44, 58, 78)"] {
        background-color: var(--tweak-bg-secondary) !important;
        transition-property: var(--tweak-transition-properties), transform;

        &:active {
            transform: scale(0.9);
        }
    }

    /* on/off switches */
    .r-1mhb1uw.r-1k25im9,
    div[style*="height: 24px; width: 36px;"] {
        justify-content: center;
        border-width: 1px !important;
        background: var(--tweak-fg-more-translucent) !important;

        > div {
            background: var(--tweak-fg-translucent) !important;

            &.r-1ow6zhx, &[style*="align-self: flex-end"] {
                margin-left: auto !important;
                background: var(--tweak-accent) !important;
            }
        }
    }

    /* FIXME radio buttons */
    div[role="radio"] > div[style*="border-radius: 999px"] {
        border-width: 1px !important;
    }
    div[role="radio"][aria-checked="true"]
        > div[style*="border-radius: 999px"]
        > div[style*="border-radius: 999px"] {
            background: var(--tweak-fg-translucent) !important;
        }

    /* FIXME checkboxes */
    div[role="checkbox"] div[style*="border-color"] {
        border-width: 1px !important;

        &:is([aria-checked="true"] div) {
            background-color: var(--tweak-bg-secondary) !important;
        }
    }

    /* segmented controls */
    div[role="radiogroup"] > [style*="flex-direction: row;"] > div[role="radio"] {
        &[aria-checked="false"] > div {
            background: var(--tweak-fg-more-translucent) !important;
        }
        &[aria-checked="true"] > div {
            background: var(--tweak-fg-translucent) !important;
            > div {
                color: var(--tweak-bg) !important;
            }
        }
    }

    /* tooltips */
    [data-tooltip]::after {
        box-shadow: var(--tweak-shadow);
        border-radius: 6px;
        background-color: var(--tweak-bg);
        color: var(--tweak-fg);

        :root.theme--dim & {
            border: 1px solid;
            border-color: inherit;
        }
    }

    /* FIXME toasts */
    .r-umfvqw.r-18rd0c5.r-ctyi22 {
        -webkit-backdrop-filter: var(--tweak-blur);
        backdrop-filter: var(--tweak-blur);
        box-shadow: var(--tweak-shadow);
        background-color: var(--tweak-bg-translucent);
        :root.theme--dim & {
            border-width: 1px !important;
        }
        > div {
            color: var(--tweak-fg);
        }
    }

    /* notification badge */
    :is(a, div)[aria-label="Notifications"] div[aria-label*="unread item"] {
        background-color: var(--tweak-accent) !important;
        color: var(--tweak-bg) !important;

        div {
            color: var(--tweak-bg) !important;
        }
    }

    /* ----- !LAYOUT ----- */

    /* blur toolbar backgrounds */
    /* tab bars */
    div:has(> div > div[data-testid$="-selector"]),
    /* mobile nav bar */
    nav.r-1p0dtai {
        -webkit-backdrop-filter: var(--tweak-blur) !important;
        backdrop-filter: var(--tweak-blur) !important;
        background: var(--tweak-bg-translucent) !important;

        > div {
            background: transparent !important;
        }

        @media (prefers-reduced-transparency: reduce) {
            -webkit-backdrop-filter: none !important;
            backdrop-filter: none !important;
            background: var(--tweak-bg) !important;
        }
    }

    /* nav bar icons for all layouts */
    nav[role="navigation"] svg {
        height: 28px;
    }

    /* mobile nav bar */
    nav.r-1p0dtai {
        box-shadow: var(--tweak-shadow);
    }

    /* mobile unread chat badge */
    div.r-wzwllv {
        background-color: var(--tweak-accent) !important;
    }

    /* hamburger menu drawer */
    div[data-testid='drawer'] {
        box-shadow: var(--tweak-shadow);
        background-color: var(--tweak-bg) !important;
    }

    /* hamburger menu drawer Help text */
    button[aria-label="Get help"] > div {
        color: var(--tweak-fg-translucent) !important;
    }

    /* hamburger menu notifications badge */
    button[data-testid="menuItemButton-Notifications"] svg + div > div {
        background-color: var(--tweak-accent) !important;

        > div {
            color: var(--tweak-bg) !important;
        }
    }

    /* ----- !FEED ----- */

    /* custom title */
    :is(div, button):has(> svg > path[d^="M13.873"]) {
        width: max(var(--tweak-option-use-title), 28px) !important;
        text-align: center;

        > svg {
            display: var(--tweak-option-use-title);
        }

        &::after {
            order: -1;
            -webkit-background-clip: text;
            background-clip: text;
            background-color: var(--tweak-fg);
            width: var(--tweak-option-use-title);
            height: var(--tweak-option-use-title);
            content: var(--tweak-option-title);
            color: transparent;
            font-size: 24px;
            text-box-trim: trim-both;
        }
    }

    /* feed, profile, list tab container */
    div[role="tablist"] > div > div {
        margin-inline: auto;
    }

    /* feed, profile, list tab */
    div[role="tab"] {
        margin-inline: 3.5px;
        border-radius: var(--tweak-radius);
        background-clip: padding-box;

        > div {
            padding-bottom: 0;
        }

        /* inactive tab names */
        .r-oucylx div {
            font-weight: 500 !important;
        }
    }

    /* scroll to top button */
    button[aria-label="Load new posts"],
    button[aria-label="Load new notifications"] {
        box-shadow: var(--tweak-shadow);
        background: var(--tweak-bg) !important;

        :root.theme--dim & {
            border-width: 1px !important;
        }

        &:hover {
            background: var(--tweak-bg-secondary) !important;
        }

        > div:first-child {
            display: none;
        }
    }

    /* floating compose buttons */
    button[data-testid="composeFAB"],
    button[data-testid="newChatFAB"] {
        cursor: pointer;

        > div {
            box-shadow: var(--tweak-shadow);
        }

        svg {
            stroke: var(--tweak-bg);
        }

        path {
            fill: transparent !important;
        }
    }

    /* desktop compose button */
    button[aria-label="Compose new post"][class][style] {
        background: var(--tweak-accent) !important;

        &:hover, &:active {
            background: var(--tweak-accent-darker) !important;
        }

        div {
            color: var(--tweak-bg) !important;
        }

        path {
            fill: var(--tweak-bg) !important;
        }
    }

    /* ----- !POSTS ----- */

    /* post hover overlay */
    div[data-testid^='feedItem-'] > div > div:first-child:empty,
    /* quote post hover overlay */
    div:first-child:empty:has(~ div[aria-label^="Post by"]),
    /* reply hover overlay */
    div:first-child:empty:has(~ div[data-testid^="postThreadItem-"])
    {
        opacity: 0 !important;
    }

    /* disable hand cursor */
    div[data-testid^='feedItem-'].r-1loqt21,
    div[data-testid^='feedItem-'] > .r-1loqt21,
    /* replies */
    div > div[data-testid^="postThreadItem-"]
    {
        cursor: auto;
    }

    /* quote posts */
    div:is(
        [data-testid='contentHider-post'],
        [data-testid^="postThreadItem-"],
        [data-testid^="feedItem-"],
        [data-testid="composePostView"]
    ) div:has(> [aria-label^="Post by"]),
    /* URL cards in posts */
    div:is(
        [data-testid='contentHider-post'],
        [data-testid^="postThreadItem-"]
    ) a[target="_blank"][aria-label],
    /* URL cards in post composer */
    div[data-testid="composePostView"] div:has(
        > div > button[aria-label="Remove attachment"]
    ),
    /* content warnings */
    button:is(
        [aria-label="Adult Content"],
        [aria-label="Sexually Suggestive"],
        [aria-label="Non-sexual Nudity"],
        [aria-label="Sexually Suggestive (Cartoon)"],
        [aria-label="Graphic Media"],
        [aria-label="Self-Harm"],
        [aria-label="Sensitive"],
        [aria-label="Extremist"],
        [aria-label="Intolerance"],
        [aria-label="Threats"],
        [aria-label="Rude"],
        [aria-label="Illicit"],
        [aria-label="Security Concerns"],
        [aria-label="Unsafe link"],
        [aria-label="Misinformation"],
        [aria-label="Scam"],
        [aria-label="Engagement Farming"],
        [aria-label="Spam"],
        [aria-label="Misleading"],
        [aria-label="Inauthentic Account"],
        [aria-label="Post Hidden by Muted Word"]
    ) > div {
        border-width: 1px !important;
        border-radius: var(--tweak-radius);
        background: transparent !important;

        @container style(--tweak-option-small-link-previews: yes) {
            > div:has(> div[data-expoimage="true"]) {
                flex-direction: row !important;

                > div[data-expoimage="true"] {
                    flex: 0 0 25%;
                }
            }
        }

        &:hover {
            border-color: transparent !important;
            background: var(--tweak-fg-more-translucent) !important;
        }

        > div {
            margin-top: 0 !important;
            border-radius: var(--tweak-radius) !important;
        }
    }

    /* top margin for URL cards */
    div:is(
        [data-testid='contentHider-post'],
        [data-testid^="postThreadItem-"]
    ) a[target="_blank"][aria-label] {
        margin-top: 8px;
    }

    /* post actions in feed */
    div[data-testid="contentHider-post"] + div,
    /* post actions in post view */
    div[data-testid="postThreadScreen"] div[data-testid^="postThreadItem-by"] > div:last-child > div:last-child,
    /* reply notification actions */
    div[data-testid="notifsFeed"] div[data-testid^='feedItem-'] div:last-child[style*="justify-content: space-between;"] {
        /* reply/repost count */
        svg + div,
        /* fav count */
        button div {
            color: var(--tweak-fg-translucent) !important;
        }

        /* hover */
        button:not(
            div[aria-label="Embedded video player"] button
        ):not(
            :has(+ video)
        ):not(
            [style*="background-color: rgba(0, 0, 0, 0)"]
        ) {
            background-color: var(--tweak-bg-secondary) !important;
        }

        /* icons */
        path {
            fill: var(--tweak-fg-translucent) !important;
        }
    }

    /* back button */
    div[data-testid="postThreadScreen"] button[aria-label="Go back"] {
        background-color: transparent !important;

        &:hover {
            background-color: var(--tweak-bg-secondary) !important;
        }
    }

    /* thread lines */
    .r-m5arl1,
    div[data-testid="postThreadScreen"] div[style*="; width: 2px"] {
        background-color: var(--tweak-fg-more-translucent) !important;
    }
    /* nested thread lines */
    div[data-testid="postThreadScreen"] {
        /* var(--tweak-fg-more-translucent) won't work because of stacked lines */
        --thread-border-color: color-mix(in srgb, var(--tweak-fg) 25%, var(--tweak-bg)) !important;

        div[style*="border-right-width: 2px"] {
            border-color: var(--thread-border-color) !important;
            border-right-width: 2px !important;
        }
        div[style*="border-left-width: 2px"] {
            border-color: var(--thread-border-color) !important;
            border-left-width: 2px !important;
        }
        div[style*="border-bottom-width: 2px"] {
            border-color: var(--thread-border-color) !important;
            border-bottom-width: 2px !important;
        }
    }

    /* thread line ellipses */
    svg:has(> line + circle + circle + circle) {
        color: var(--tweak-fg-more-translucent) !important;

        > line {
            stroke: currentColor !important;
        }

        > circle {
            fill: currentColor !important;
        }
    }

    /* "View full thread" and "Continue thread" links */
    div[data-testid="followingFeedPage-feed-flatlist"] a[href^="/profile/"] div[style*="font-variant: no-contextual"],
    div[data-testid="postThreadScreen"] div.css-g5y9jx:has(+ div.css-g5y9jx.r-633pao.r-1wyyakw) div[style*="font-variant: no-contextual"] {
        color: var(--tweak-fg) !important;
    }

    /* hand cursor for "view full thread" link */
    .r-e69tdv ~ .css-1rynq56 {
        cursor: pointer !important;
    }

    /* reply bar at bottom on mobile */
    div[data-testid="postThreadScreen"] div[style*="background-image: linear-gradient"] {
        background: transparent !important;
    }
    button[aria-label="Compose reply"] {
        background: var(--tweak-fg-more-translucent) !important;
        backdrop-filter: var(--tweak-blur);
    }

    /* ----- !CONTEXT MENUS ----- */

    /* disable language picker background dim */
    div[aria-label="Toggle dropdown"] {
        opacity: 0;
    }

    div[data-radix-popper-content-wrapper] {
        background: transparent !important;
        border-radius: var(--tweak-radius) !important;
    }

    /* styles for the menu itself */
    div[data-radix-menu-content] {
        transform-origin: top center;
        -webkit-backdrop-filter: var(--tweak-blur);
        backdrop-filter: var(--tweak-blur);
        animation: 125ms scale-up;
        background: var(--tweak-bg-translucent) !important;
        border-radius: var(--tweak-radius) !important;

        @media (prefers-reduced-transparency: reduce) {
            -webkit-backdrop-filter: none;
            backdrop-filter: none;
            background: var(--tweak-bg) !important;
        }

        @media (prefers-reduced-motion: reduce) {
            animation-name: fade-in;
        }

        :root.theme--dim & {
            border-width: 1px !important;
        }

        > div {
            border-radius: var(--tweak-radius) !important;
        }

        /* menu item wrapper */
        > div:not([role]),
        /* list edit menu */
        &:has(> .nativeDropdown-item) {
            box-shadow: var(--tweak-shadow) !important;
            background-color: transparent !important;
        }

        /* menu items */
        div[role="menuitem"] {
            &[style*="background-color"] {
                background: var(--tweak-bg-secondary) !important;
            }

            &:first-child {
                border-top-right-radius: var(--tweak-radius) !important;
                border-top-left-radius: var(--tweak-radius) !important;
            }
            &:last-child {
                border-bottom-right-radius: var(--tweak-radius) !important;
                border-bottom-left-radius: var(--tweak-radius) !important;
            }

            > div {
                color: var(--tweak-fg) !important;
                font-weight: 400 !important;
                font-size: 16px !important;
                user-select: none;
            }

            svg path {
                fill: currentColor !important;
            }
        }
    }

    /* language picker */
    div[aria-label="Toggle dropdown"] + div:has(> button) {
        transform-origin: bottom right;
        box-shadow: var(--tweak-shadow);
        padding-inline: 4px;
    }

    /* hover highlight for language picker options */
    div[aria-label="Toggle dropdown"] + div > button:hover {
        border-radius: 8px;
        background-color: rgba(0, 0, 0, 0.067) !important;

        :root.theme--dim & {
            background: rgba(255, 255, 255, 0.07) !important;
        }
    }

    /* dividers */
    div[data-radix-menu-content] div[role='separator'] {
        background: var(--tweak-fg-more-translucent) !important;
    }
    div[aria-label="Toggle dropdown"] + div > div {
        border-bottom-width: 1px !important;
        border-color: var(--tweak-fg-more-translucent) !important;
    }

    /* fix padding for "Post language" label */
    div[aria-label="Toggle dropdown"] + div > div:first-child {
        border-radius: 0 !important;
        padding-bottom: 16px;
    }

    /* ----- !MODALS ----- */

    /* modals */
    /* TODO some modals in Settings aren't matched by this */
    div[role="dialog"]:not(:has([data-testid="composePostView"])),
    div:has(> div[data-testid="composePostView"]),
    div:has(> div > div[data-testid="editProfileModal"]),
    div:has(> div[data-testid="userAddRemoveListsModal"]) {
        margin: 0 20px !important;
        box-shadow: var(--tweak-shadow) !important;
        border-radius: var(--tweak-radius) !important;
        max-width: min(600px, calc(100vw - 40px)) !important;

        :root.theme--dim & {
            border-width: 1px !important;
        }
    }

    /* blurred backgrounds */
    /* hamburger menu */
    div[aria-label="Close drawer menu"],
    /* post composer and most other modals */
    div[aria-label="Close active dialog"]:has([role="dialog"]),
    /* edit profile */
    div[style*="background-color: rgba(0, 0, 0, 0.8)"],
    /* image viewer */
    div:has(> button[aria-label="Close image viewer"]) {
        background: transparent !important;

        /* the pseudo-element works around a Safari issue */
        &::before {
            position: fixed;
            top: 0;
            left: 0;

            opacity: 1;
            -webkit-backdrop-filter: var(--tweak-blur) !important;
            backdrop-filter: var(--tweak-blur) !important;
            transition: opacity 250ms;
            /* animation: 250ms fade-in; */
            background: var(--tweak-bg-translucent) !important;
            width: 100%;
            height: 100%;
            pointer-events: none;
            content: '';
            @starting-style {
                opacity: 0;
            }

            @media (prefers-reduced-transparency: reduce) {
                -webkit-backdrop-filter: none !important;
                backdrop-filter: none !important;
                background: var(--tweak-bg-secondary) !important;
            }
        }

        &[style*="background-color: rgba(0, 0, 0, 0)"]::before {
            opacity: 0;
        }
    }

    /* ----- !POST COMPOSER ----- */

    /* vertically center */
    div[role="dialog"]:has(> div > div[data-testid='composePostView']) {
        justify-content: center;
    }

    /* Cancel button */
    :root div[data-testid="composePostView"] button[role="button"][aria-label="Cancel"] {
        background-color: transparent !important;

        &:active {
            transform: scale(0.9);
        }

        div {
            color: var(--tweak-fg) !important;
        }
    }

    /* Post button */
    div[data-testid="composePostView"] button[data-testid="composerPublishBtn"][style] {
        background-color: var(--tweak-accent) !important;

        div {
            color: var(--tweak-bg) !important;
        }

        &:hover {
            background-color: var(--tweak-accent-darker) !important;
        }

        &[disabled] {
            background-color: var(--tweak-bg-secondary) !important;

            div {
                color: var(--tweak-fg-more-translucent) !important;
            }
        }
    }

    /* attachment button hover */
    div[data-testid="composePostView"] :is(
        :root.theme--light button[style*="background-color: rgb(204, 225, 255)"],
        :root.theme--dim button[style*="background-color: rgb(18, 52, 100)"]
    ) {
        background-color: var(--tweak-bg-secondary) !important;
    }

    /* post composer and alt text text fields */
    .ProseMirror p,
    textarea[aria-label="Alt text"] {
        color: var(--tweak-fg);
        text-transform: none !important;
    }

    /* links */
    .ProseMirror .autolink,
    /* usernames */
    .ProseMirror .mention {
        color: var(--tweak-accent);
    }

    /* character count circle */
    div[data-testid='composePostView'] svg[width="30"][height="30"] path,
    /* alt text character count circle */
    div[aria-label="Add alt text"] svg[width="26"][height="26"] path {
        stroke: var(--tweak-accent) !important;
    }

    /* URL card remove button */
    button[aria-label="Remove attachment"] {
        background: var(--tweak-accent) !important;

        path[fill] {
            fill: var(--tweak-bg) !important;
        }
    }

    /* username autocomplete popup */
    .tippy-box .items {
        box-shadow: var(--tweak-shadow);
        border-radius: var(--tweak-radius);
        overflow: hidden;

        :root.theme--dim & {
            border-width: 1px !important;
        }

        button {
            background-color: transparent;
            border-radius: 8px !important;

            &[style*="background-color:"] {
                background-color: var(--tweak-accent) !important;

                div[style*="color"] {
                    color: var(--tweak-bg) !important;
                }
            }

            &:first-child {
                border-top-right-radius: var(--tweak-radius);
                border-top-left-radius: var(--tweak-radius);
            }

            &:last-child {
                border-bottom-right-radius: var(--tweak-radius);
                border-bottom-left-radius: var(--tweak-radius);
            }
        }
    }

    /* FIXME reply settings hover and selected */
    div[aria-label="Edit post interaction settings"] :is(
        button[aria-checked="true"] > div,
        :root.theme--light div[style*="background-color: rgb(212, 219, 226)"],
        :root.theme--dim div[style*="background-color: rgb(46, 64, 82)"]
    ) {
        background: var(--tweak-accent) !important;

        > div {
            color: var(--tweak-bg) !important;
        }

        path {
            fill: var(--tweak-bg) !important;
        }
    }

    /* ----- !IMAGES & VIDEO ----- */

    /* image background */
    div[data-expoimage="true"] img {
        background-color: var(--tweak-bg-secondary);
    }

    /* alt text indicator */
    :is(
        div[data-expoimage="true"],
        button:has(> div[data-expoimage="true"])
    ) ~ div[style*="bottom: 4px; right: 4px;"] > div {
        border-radius: 4px;
        background-color: var(--tweak-bg) !important;

        > div > div {
            color: var(--tweak-fg) !important;
        }
    }

    /* image viewer buttons */
    button[aria-label="Close image"],
    button[aria-label='Previous image'],
    button[aria-label='Next image'] {
        opacity: 0.5;
        -webkit-backdrop-filter: none !important;
        backdrop-filter: none !important;
        background: var(--tweak-bg-tertiary);
        transition: var(--tweak-transition-timing) !important;
        transition-property: background, opacity !important;

        @media (hover: hover) {
            opacity: 0;

            div:has(> button[aria-label="Close image viewer"]):hover & {
                opacity: 0.5;

                &:hover {
                    opacity: 1;
                }
            }
        }
    }

    /* move close button to left */
    div:has(> div > button[aria-label="Close image"]) {
        right: auto !important;
        left: 10px;
    }

    /* remove transition from images */
    button[aria-label="Close image viewer"] div:has(+ img) {
        transition: none !important;
    }

    /* alt text */
    div:has(> div[aria-label='Expand alt text']) {
        box-shadow: var(--tweak-shadow);
        background-color: var(--tweak-bg);
    }
    div[aria-label='Expand alt text'] > div {
        cursor: text;
        color: var(--tweak-fg) !important;
        user-select: text;
        text-transform: none !important;
    }

    /* video player control colors */
    div[aria-label="Embedded video player"] {
        --contrast-color: var(--tweak-bg);
        :root.theme--dim & {
            --contrast-color: var(--tweak-fg);
        }

        /* player controls */
        button:is(
            [aria-label="Play"],
            [aria-label="Pause"],
            [aria-label="Mute"],
            [aria-label="Unmute"],
            [aria-label="Enter fullscreen"]
        ) > svg > path {
            color: var(--contrast-color) !important;
            fill: var(--contrast-color) !important;
        }

        /* elapsed time */
        [style*="color: rgb(255, 255, 255)"] {
            color: var(--contrast-color) !important;
        }

        /* scrubber */
        div[data-testid="scrubber"] {
            div[style*="background-color: rgb(255, 255, 255)"] {
                background-color: var(--contrast-color) !important;
            }
            div[style*="background-color: rgba(255, 255, 255, 0.4)"] {
                background-color: var(--contrast-color) !important;
            }
        }

        /* volume slider */
        input[type="range"] {
            background-color: transparent !important;
            accent-color: var(--contrast-color) !important;

            &::-webkit-slider-thumb,
            &::-webkit-slider-runnable-track {
                background-color: var(--contrast-color) !important;
            }
        }
    }

    /* ----- !NOTIFICATIONS ----- */

    div[data-testid="notifsFeed"] {
        /* notification spacing */
        & > div[style^="width: 100%;"] > div > div {
            margin: 8px 8px 0 !important;
            border-radius: var(--tweak-radius);
            overflow: hidden;
        }

        /* highlight new notifications */
        a[data-testid^="feedItem-by-"][style*="background-color"],
        div[data-testid^="feedItem-by-"] > div[style*="background-color"] {
            background: var(--tweak-accent-more-translucent) !important;
        }

        /* disable hover highlight */
        a[data-testid^='feedItem-'] > div:first-child:empty,
        div[data-testid^='feedItem-']:hover > [role='link'] {
            background-color: transparent !important;
        }

        /* disable hand cursor on notification body */
        a[data-testid^='feedItem-'].r-1otgn73 {
            cursor: default !important;
        }
        /* restore on images */
        [data-expoimage="true"] {
            cursor: pointer;
        }
    }

    /* ----- !PROFILE ----- */

    [data-testid="profileView"] {
        /* back button */
        button[aria-label="Back"] {
            > div {
                background: var(--tweak-bg) !important;
                
                &:hover {
                    background: var(--tweak-bg-secondary) !important;
                }
            }
            
            path {
                fill: var(--tweak-fg) !important;
            }
        }
        
        /* restore profile pic border */
        div[data-testid="profileHeaderAviButton"] {
            border: 2px solid var(--tweak-bg) !important;
        }

        /* hand cursor for profile pic */
        div[data-testid="userAvatarImage"] {
            cursor: pointer;
        }

        /* "Follows you" box */
        :root.theme--light & div[style*="background-color: rgb(239, 242, 246)"],
        :root.theme--dim & div[style*="background-color: rgb(34, 46, 63)"]{
            background: var(--tweak-bg-secondary) !important;
        }
    }


    /* ----- !CHATS ----- */

    div[data-testid="messagesScreen"] {
        /* new chat button */
        a[aria-label="Chat settings"] + button[aria-label="New chat"] {
            background-color: var(--tweak-accent) !important;

            &:hover, &:active {
                background-color: var(--tweak-accent-darker) !important;
            }
        }

        /* chats */
        a[href^="/messages/"] {
            cursor: default;

            > div[style*="background-color:"] {
                background-color: transparent !important;
            }
        }

        /* chat request banner */
        a[aria-label="Chat request inbox"] {
            background-color: var(--tweak-bg-secondary) !important;
            cursor: pointer !important;
        }
    }

    div[data-testid="messagesInboxScreen"] {
        /* chat requests */
        a[href^="/messages/"] > div {
            background-color: transparent !important;
            cursor: default;
        }
    }

    div[data-testid="convoScreen"] {
        /* incoming message bubbles */
        div[style*="align-self: flex-start"]:has(> div[data-word-wrap="1"]) {
            background-color: var(--tweak-fg) !important;

            > div, a {
                color: var(--tweak-bg) !important;
            }
        }

        /* sent message bubbles */
        div[style*="align-self: flex-end"]:has(> div[data-word-wrap="1"]) {
            background-color: var(--tweak-accent) !important;

            > div, a {
                color: var(--tweak-bg) !important;
            }
        }

        /* message text field */
        div:has(> textarea[placeholder="Write a message"]) {
            align-items: center;
            background-color: var(--tweak-fg-more-translucent) !important;

            textarea {
                padding-block: 0 !important;
                resize: none !important;
            }

            button {
                margin-top: 0 !important;
            }

            button[aria-label="Send message"] {
                background-color: var(--tweak-accent) !important;

                path {
                    fill: var(--tweak-bg) !important;
                }
            }
        }

        /* remove gap under message text field  */
        div:has(> div > div > textarea[placeholder="Write a message"]) {
            transform: none !important;
        }
    }

    /* ----- !SETTINGS ----- */

    /* TODO */
}
