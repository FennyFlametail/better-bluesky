/* ==UserStyle==
@name           Better Bluesky
@namespace      https://bsky.app/profile/fenny.zone
@version        2025-12-30
@description    by @fenny.zone on Bluesky. Loosely based on the "blue blue sky" Arc boost by @twobabyteeth on Twitter.
@author         https://bsky.app/profile/fenny.zone
@supportURL     https://bsky.app/profile/fenny.zone
@license        MIT
@match          https://*.bsky.app/*

@var select tweak-option-use-title "Use title emoji" {
  "yes:Yes": "none",
  "no:No": "0px"
}
@var text tweak-option-title "Title emoji (in quotes)" "'☁️'"
@var text tweak-option-font "Font family" "'Avenir Next', 'SF Pro Rounded', ui-rounded, system-ui;"
@var number tweak-option-line-height "Line height" [1.3, null, null, 0.05]
@var select tweak-option-text-transform "Text transform" {
  "none:None": "revert",
  "lowercase:lowercase": "lowercase",
  "uppercase:UPPERCASE": "uppercase"
}
@var select tweak-option-count-display "Show reply/repost/like counts" {
  "yes:Yes": "flex",
  "hover:On hover (Chrome/Safari only)": "--on-hover",
  "no:No": "none"
}
@var select tweak-option-disable-text-outlines "Disable focus outlines on text fields" {
  "yes:Yes": "none",
  "no:No": "1px auto"
}
@var select tweak-option-small-link-previews "Small link previews (Chrome/Safari only)" {
  "yes:Yes": "yes",
  "no:No*": "no"
}
@var color tweak-option-bg "Light mode background" #f9f3ec
@var color tweak-option-accent "Light mode accent (contrast with background)" #388098
@var color tweak-option-text "Light mode text (contrast with background)" #9e5574
@var color tweak-option-danger "Light mode destructive actions (contrast with background)" #c6262e
@var color tweak-option-bg-dark "Dark mode background" #222232
@var color tweak-option-accent-dark "Dark mode accent" #f48da4
@var color tweak-option-text-dark "Dark mode text" #8fc7e8
@var color tweak-option-danger-dark "Dark mode destructive actions" #ed5353
==/UserStyle== */

/* To install using Userscripts for iOS/Mac:
    1. Customize the :root block below with your desired options.
    2. Delete the @-moz-document line, and the final line (the lone "}").
    3. Paste the :root block below the long line with all the code.

    When the theme updates, repeat steps 2 and 3.

:root {
    --tweak-option-use-title: none;
    --tweak-option-title: '☁️';
    --tweak-option-font: 'Avenir Next', 'SF Pro Rounded', ui-rounded, system-ui;
    --tweak-option-line-height: 1.3;
    --tweak-option-text-transform: revert;
    --tweak-option-count-display: flex;
    --tweak-option-disable-text-outlines: none;
    --tweak-option-small-link-previews: no;

    --tweak-option-accent: #388098;
    --tweak-option-bg: #f9f3ec;
    --tweak-option-text: #9e5574;

    --tweak-option-accent-dark: #f48da4;
    --tweak-option-bg-dark: #222232;
    --tweak-option-text-dark: #8fc7e8;
}

/instructions */

/*
Section headings (use Cmd-F to navigate)
!GENERAL
!CONTROLS
!LAYOUT
!FEED
!POSTS
!CONTEXT MENUS
!MODALS
!POST COMPOSER
!IMAGES & VIDEO
!NOTIFICATIONS
!PROFILE
!CHATS
!SETTINGS
*/

@-moz-document domain("bsky.app") {
    @keyframes fade-in {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    @keyframes scale-up {
        from {
            transform: scale(0);
        }
        to {
            transform: scale(1);
        }
    }

    /* ----- !GENERAL ----- */

    :root,
    :root.theme--light,
    :root.theme--dim {
        --tweak-accent: var(--tweak-option-accent, #388098);
        --tweak-bg: var(--tweak-option-bg, #f9f3ec);
        --tweak-fg: var(--tweak-option-text, #9e5574);
        --tweak-danger: var(--tweak-option-danger, #c6262e);

        --tweak-bg-secondary: color-mix(in srgb, var(--tweak-bg) 90%, black);
        --tweak-bg-tertiary: color-mix(in srgb, var(--tweak-bg) 75%, black);
        --tweak-bg-translucent: color-mix(in srgb, var(--tweak-bg) 75%, transparent);
        --tweak-fg-translucent: color-mix(in srgb, var(--tweak-fg) 75%, transparent);
        --tweak-fg-more-translucent: color-mix(in srgb, var(--tweak-fg) 25%, transparent);
        --tweak-accent-darker: color-mix(in srgb, var(--tweak-accent) 80%, black);
        --tweak-accent-translucent: color-mix(in srgb, var(--tweak-accent) 50%, transparent);
        --tweak-accent-more-translucent: color-mix(in srgb, var(--tweak-accent) 25%, transparent);
        --tweak-danger-darker: color-mix(in srgb, var(--tweak-danger) 80%, black);

        --tweak-radius: 14px;
        --tweak-blur: blur(30px);
        --tweak-shadow: rgba(0, 0, 0, 0.3) 0px 5px 20px;
        --tweak-transition-properties: background, border-color;
        --tweak-transition-timing: 100ms ease;

        --background: var(--tweak-bg) !important;
        --backgroundLight: var(--tweak-bg) !important;
        --text: var(--tweak-fg) !important;
        background-color: var(--tweak-bg) !important;
        
        &::selection {
            background-color: var(--tweak-fg-more-translucent);
        }
    }

    :root.theme--dim {
        --tweak-accent: var(--tweak-option-accent-dark, #f48da4);
        --tweak-bg: var(--tweak-option-bg-dark, #222232);
        --tweak-fg: var(--tweak-option-text-dark, #8fc7e8);
        --tweak-danger: var(--tweak-option-danger-dark, #ed5353);

        --tweak-bg-secondary: color-mix(in srgb, var(--tweak-bg) 90%, white);
        --tweak-bg-tertiary: color-mix(in srgb, var(--tweak-bg) 75%, white);
    }

    :root.theme--dark body::after {
        position: fixed;
        top: 0;
        left: 0;
        background: var(--tweak-option-bg-dark);
        width: 100vw;
        content: 'To use Better Bluesky, set your dark theme to "Dim" in Settings > Appearance!';
        color: var(--tweak-option-text-dark);
        text-align: center;
    }

    * {
        border: 0px solid var(--tweak-fg-more-translucent) !important;
        transition: var(--tweak-transition-timing);
        transition-property: var(--tweak-transition-properties);
        text-decoration-color: currentColor !important;
        -webkit-font-smoothing: auto;
    }
    *:focus {
        outline: none;
    }
    *:focus-visible {
        outline: 1px auto;
    }
    *:is(input, textarea, .ProseMirror):focus-visible {
        outline: var(--tweak-option-disable-text-outlines, none);
    }
    *:not(input, textarea, .ProseMirror) {
        text-transform: var(--tweak-option-text-transform, 'lowercase');
    }

    *:not(.material-symbols-outlined, .material-icons) {
        line-height: var(--tweak-option-line-height, 1.3) !important;
        font-family: var( --tweak-option-font, 'Avenir Next', 'SF Pro Rounded', ui-rounded, system-ui) !important;
    }

    path[fill] {
        fill: var(--tweak-fg) !important;
    }

    /* common colors in light mode */
    :where(:root.theme--light) {
        /* nav item, hovered tab, hovered hamburger menu item background */
        [style*="background-color: rgb(249, 250, 251)"],
        /* loading skeletons */
        div[style*="background-color: rgb(239, 242, 246)"] {
            background-color: var(--tweak-bg-secondary) !important;
        }

        /* active tab indicator and tablet/desktop unread chat badge */
        div[style*="background-color: rgb(0, 106, 255)"],
        /* mobile chat badge */
        .r-wzwllv {
            background-color: var(--tweak-accent) !important;
        }

        /* various screen backgrounds */
        div[style*="background-color: rgb(255, 255, 255)"] {
            background-color: var(--tweak-bg) !important;
        }

        /* primary text */
        [style*="color: rgb(0, 0, 0)"],
        /* "View full thread" link */
        div.css-146c3p1[style*="rgb(0, 106, 255)"] {
            color: var(--tweak-fg) !important;
        }

        /* secondary dimmed text */
        [style*="color: rgb(64, 81, 104)"],
        /* reply post and content warning Show text */
        [style*="color: rgb(35, 46, 62)"] {
            color: var(--tweak-fg-translucent) !important;
        }

        :is(
            /* link text */
            a, span,
            /* ex. language button on post composer */
            button > div
        )[style*="color: rgb(0, 106, 255)"] {
            color: var(--tweak-accent) !important;
        }

        /* destructive action text */
        [style*="color: rgb(233, 22, 70)"] {
            color: var(--tweak-danger) !important;
        }
        /* destructive action icons */
        path[fill="#E91646"] {
            fill: var(--tweak-danger) !important;
        }
    }

    /* common colors in dark mode */
    :where(:root.theme--dim) {
        /* nav item, hovered tab, hovered hamburger menu item background */
        [style*="background-color: rgb(28, 39, 54)"],
        /* loading skeletons */
        div[style*="background-color: rgb(34, 46, 63)"] {
            background-color: var(--tweak-bg-secondary) !important;
        }

        /* active tab indicator and tablet/desktop unread chat badge */
        div[style*="background-color: rgb(15, 115, 255)"],
        /* mobile chat badge */
        .r-wzwllv {
            background-color: var(--tweak-accent) !important;
        }

        /* various screen backgrounds */
        div[style*="background-color: rgb(21, 29, 40)"] {
            background-color: var(--tweak-bg) !important;
        }

        /* primary text */
        [style*="color: rgb(255, 255, 255)"],
        /* "View full thread" link and language picker button */
        div.css-146c3p1[style*="rgb(15, 115, 255)"] {
            color: var(--tweak-fg) !important;
        }

        /* secondary dimmed text */
        [style*="color: rgb(171, 184, 201)"],
        /* reply post and content warning Show text */
        [style*="color: rgb(226, 231, 238)"] {
            color: var(--tweak-fg-translucent) !important;
        }

        :is(
            /* link text */
            a, span,
            /* ex. language button on post composer */
            button > div
        )[style*="color: rgb(15, 115, 255)"] {
            color: var(--tweak-accent) !important;
        }

        /* destructive action text */
        [style*="color: rgb(235, 36, 82)"] {
            color: var(--tweak-danger) !important;
        }
        /* destructive action icons */
        path[fill="#EB2452"] {
            fill: var(--tweak-danger) !important;
        }
    }

    /* ----- !CONTROLS ----- */

    /* text fields */
    input + div,
    /* alt text box */
    textarea + div,
    /* "Write your reply" fake text box at bottom of posts */
    button[aria-label="Compose reply"] {
        background: var(--tweak-fg-more-translucent) !important;
    }

    input::placeholder,
    textarea::placeholder,
    p[data-placeholder]::before {
        color: var(--tweak-fg-translucent) !important;
    }

    textarea {
        resize: vertical !important;
    }

    /* blue roundrect buttons */
    :where(
        :root.theme--light button[style*="background-color: rgb(0, 106, 255)"],
        :root.theme--dim button[style*="background-color: rgb(15, 115, 255)"],
        button[data-testid="followBtn"]
     ) {
        background-color: var(--tweak-fg) !important;
        transition-property: var(--tweak-transition-properties), transform;

        div[dir="auto"] {
            color: var(--tweak-bg) !important;
        }

        path:not([data-testid="composeFAB"] path) {
            fill: var(--tweak-bg) !important;
        }
    }
    /* blue roundrect button hover */
    :where(
        :root.theme--light button[style*="background-color: rgb(0, 89, 214)"],
        :root.theme--dim button[style*="background-color: rgb(77, 151, 255)"],
        button[data-testid="followBtn"]:hover
     ) {
        background-color: var(--tweak-accent) !important;
        transition-property: var(--tweak-transition-properties), transform;

        &:active {
            transform: scale(0.9);
        }

        div[dir="auto"] {
            color: var(--tweak-bg) !important;
        }

        path {
            fill: var(--tweak-bg) !important;
        }
    }

    /* destructive buttons */
    :root.theme--light button[style*="background-color: rgb(233, 22, 70)"],
    :root.theme--dim button[style*="background-color: rgb(235, 36, 82)"] {
        background-color: var(--tweak-danger) !important;
        transition-property: var(--tweak-transition-properties), transform;

        &:active {
            transform: scale(0.9);
        }

        div[dir="auto"] {
            color: var(--tweak-bg) !important;
        }

        path {
            fill: var(--tweak-bg) !important;
        }
    }
    /* destructive buttons hover */
    :root.theme--light button[style*="background-color: rgb(202, 18, 61)"],
    :root.theme--dim button[style*="background-color: rgb(247, 100, 134)"] {
        background-color: var(--tweak-danger-darker) !important;
        transition-property: var(--tweak-transition-properties), transform;

        &:active {
            transform: scale(0.9);
        }

        div[dir="auto"] {
            color: var(--tweak-bg) !important;
        }

        path {
            fill: var(--tweak-bg) !important;
        }
    }

    /* accent colored buttons */
    button[data-testid="composerPublishBtn"],
    button[data-testid="editProfileSaveBtn"],
    button[aria-label="Accept chat request"],
    a[aria-label="Chat settings"] + button[aria-label="New chat"] {
        background-color: var(--tweak-accent) !important;

        > div.css-146c3p1 {
            color: var(--tweak-bg) !important;
        }

        &:hover {
            background-color: var(--tweak-accent-darker) !important;
        }

        &[disabled] {
            background-color: var(--tweak-bg-secondary) !important;

            > div.css-146c3p1 {
                color: var(--tweak-fg-more-translucent) !important;
            }
        }
    }

    /* white/black bg buttons */
    /* :not(:hover) is because non-hovered pill buttons are the same color as hovered top bar buttons */
    :where(
        /* top bar buttons */
        :root.theme--light :is(a, button)[style*="background-color: rgb(255, 255, 255)"],
        :root.theme--dim :is(a, button)[style*="background-color: rgb(21, 29, 40)"],
        /* pill buttons (profile, etc) */
        :root.theme--light :is(a, button)[style*="background-color: rgb(239, 242, 246)"],
        :root.theme--dim :is(a, button)[style*="background-color: rgb(34, 46, 63)"],
        /* post composer cancel and attachment buttons */
        button[aria-label="Cancel"],
        button[aria-label="Add another post to thread"],
        button[data-testid="openMediaBtn"],
        button[data-testid="openGifBtn"],
        button[aria-label="Open emoji picker"]
     ):not(:hover) {
        background-color: transparent !important;
        transition-property: var(--tweak-transition-properties), transform;

        &:active {
            transform: scale(0.9);
        }
    }

    /* pill buttons should have a background */
    :where(
        :root.theme--light :is(a, button)[style*="background-color: rgb(239, 242, 246)"],
        :root.theme--dim :is(a, button)[style*="background-color: rgb(34, 46, 63)"]
    ):not(:hover) {
        background-color: var(--tweak-bg-secondary) !important;
    }

    /* white/black bg buttons hover */
    :where(
        /* top bar buttons */
        :root.theme--light :is(a, button)[style*="background-color: rgb(239, 242, 246)"],
        :root.theme--dim :is(a, button)[style*="background-color: rgb(34, 46, 63)"],
        /* pill buttons */
        :root.theme--light :is(a, button)[style*="background-color: rgb(220, 226, 234)"],
        :root.theme--dim :is(a, button)[style*="background-color: rgb(44, 58, 78)"],
        /* post composer cancel and attachment buttons */
        button[aria-label="Cancel"],
        button[aria-label="Add another post to thread"],
        button[data-testid="openMediaBtn"],
        button[data-testid="openGifBtn"],
        button[aria-label="Open emoji picker"]
     ) {
        background-color: var(--tweak-fg-more-translucent) !important;
        transition-property: var(--tweak-transition-properties), transform;

        &:active {
            transform: scale(0.9);
        }
    }

    /* TODO on/off switches */
    /* .r-1mhb1uw.r-1k25im9,
    div[style*="height: 24px; width: 36px;"] {
        justify-content: center;
        border-width: 1px !important;
        background: var(--tweak-fg-more-translucent) !important;

        > div {
            background: var(--tweak-fg-translucent) !important;

            &.r-1ow6zhx, &[style*="align-self: flex-end"] {
                margin-left: auto !important;
                background: var(--tweak-accent) !important;
            }
        }
    } */

    /* TODO radio buttons */
    /* div[role="radio"] > div[style*="border-radius: 999px"] {
        border-width: 1px !important;
    }
    div[role="radio"][aria-checked="true"]
        > div[style*="border-radius: 999px"]
        > div[style*="border-radius: 999px"] {
        background: var(--tweak-fg-translucent) !important;
    } */

    /* TODO checkboxes */
    /* div[role="checkbox"] div[style*="border-color"] {
        border-width: 1px !important;

        &:is([aria-checked="true"] div) {
            background-color: var(--tweak-bg-secondary) !important;
        }
    } */

    /* segmented controls */
    div[role="radiogroup"] > div > div[role="radio"] {
        &[aria-checked="false"] > div[style^="border-left-width: 1px"] {
            background: var(--tweak-bg) !important;
        }
        &[aria-checked="true"] > div[style^="border-left-width: 1px"] {
            background: var(--tweak-fg-translucent) !important;
            > div[dir="auto"] {
                color: var(--tweak-bg) !important;
            }
        }
    }

    /* tooltips */
    [data-tooltip]::after {
        box-shadow: var(--tweak-shadow);
        border-radius: 6px;
        background-color: var(--tweak-bg);
        color: var(--tweak-fg);

        :root.theme--dim & {
            border: 1px solid;
            border-color: inherit;
        }
    }

    /* toasts */
    li[data-sonner-toast] div[style*="padding: 14px 16px;"] {
        box-shadow: var(--tweak-shadow) !important;
        background-color: var(--tweak-bg) !important;
        :root.theme--dim & {
            border-width: 1px !important;
        }
    }

    /* notification badges */
    :is(a, div):is(
        [aria-label="Notifications"],
        [aria-label="Messages"],
        [aria-label="Chat"]
    ) div[aria-label*="unread item"] {
        background-color: var(--tweak-accent) !important;
        color: var(--tweak-bg) !important;
        
        > div.css-146c3p1 {
            color: var(--tweak-bg) !important;
        }
    }

    /* ----- !LAYOUT ----- */

    /* blur toolbar backgrounds */
    /* tab bars */
    div[style^="width: 100%"]:has(> div > div[data-testid$="-selector"]),
    /* mobile nav bar */
    nav.r-1p0dtai {
        -webkit-backdrop-filter: var(--tweak-blur) !important;
        backdrop-filter: var(--tweak-blur) !important;
        background: var(--tweak-bg-translucent) !important;

        @media (prefers-reduced-transparency: reduce) {
            -webkit-backdrop-filter: none !important;
            backdrop-filter: none !important;
            background: var(--tweak-bg) !important;
        }
    }

    /* mobile nav bar */
    nav.r-1p0dtai {
        box-shadow: var(--tweak-shadow);
    }

    /* hamburger menu drawer */
    div[data-testid='drawer'] {
        box-shadow: var(--tweak-shadow);
        background-color: var(--tweak-bg) !important;
    }

    /* hamburger menu drawer Help text */
    button[aria-label="Get help"] > div.css-146c3p1 {
        color: var(--tweak-fg-translucent) !important;
    }

    /* hamburger menu notifications badge */
    button[data-testid="menuItemButton-Notifications"] div[style^="border-radius: 999px;"] {
        background-color: var(--tweak-accent) !important;

        > div[dir="auto"] {
            color: var(--tweak-bg) !important;
        }
    }

    /* ----- !FEED ----- */

    /* custom title */
    :is(
        div[style^="flex: 1 1 0%"],
        button.r-1otgn73
    ):has(> svg > path[d^="M13.873"]) {
        width: max(var(--tweak-option-use-title), 28px) !important;
        text-align: center;

        > svg {
            display: var(--tweak-option-use-title);
        }

        &::after {
            order: -1;
            -webkit-background-clip: text;
            background-clip: text;
            background-color: var(--tweak-fg);
            width: var(--tweak-option-use-title);
            height: var(--tweak-option-use-title);
            content: var(--tweak-option-title);
            color: transparent;
            font-size: 24px;
            text-box-trim: trim-both;
        }
    }

    /* feed, profile, list tab */
    div[role="tab"] {
        margin-inline: 3.5px;
        border-radius: var(--tweak-radius);
        background-clip: padding-box;

        > div:only-child {
            padding-bottom: 0;
        }
    }

    /* scroll to top button */
    button[aria-label="Load new posts"],
    button[aria-label="Load new notifications"] {
        box-shadow: var(--tweak-shadow);
        background: var(--tweak-bg) !important;

        :root.theme--dim & {
            border-width: 1px !important;
        }

        &:hover {
            background: var(--tweak-bg-secondary) !important;
        }

        > div:first-child {
            display: none;
        }
    }

    /* floating compose buttons */
    button[data-testid="composeFAB"],
    button[data-testid="newChatFAB"] {
        background-color: var(--tweak-accent) !important;
        box-shadow: var(--tweak-shadow);

        &:hover, &:active {
            background-color: var(--tweak-accent-darker) !important;
        }

        > svg[stroke="currentColor"] {
            stroke: var(--tweak-bg);
        }
    }

    /* desktop compose button (with text) */
    button[aria-label="Compose new post"] {
        background: var(--tweak-accent) !important;

        &:hover, &:active {
            background: var(--tweak-accent-darker) !important;
        }

        div[dir="auto"] {
            color: var(--tweak-bg) !important;
        }

        path {
            fill: var(--tweak-bg) !important;
        }
    }

    /* ----- !POSTS ----- */

    /* post hover overlay */
    div[data-testid^='feedItem-'] > div > div:first-child:empty,
    /* quote post hover overlay */
    div:first-child:empty:has(~ div[aria-label^="Post by"]),
    /* reply hover overlay */
    div:first-child:empty:has(~ div[data-testid^="postThreadItem-"]) {
        opacity: 0 !important;
    }

    /* disable hand cursor */
    div[data-testid^='feedItem-'].r-1loqt21,
    div[data-testid^='feedItem-'] > .r-1loqt21,
    /* replies */
    div > div[data-testid^="postThreadItem-"] {
        cursor: auto;
    }

    /* quote posts */
    div:is(
        [data-testid='contentHider-post'],
        [data-testid^="postThreadItem-"],
        [data-testid^="feedItem-"],
        [data-testid="composePostView"]
    ) div[style^="border-radius: 12px"]:has(> [aria-label^="Post by"]),
    /* URL cards in posts */
    div:is(
        [data-testid='contentHider-post'],
        [data-testid^="postThreadItem-"]
    ) a[target="_blank"][aria-label],
    /* URL cards in post composer */
    div[data-testid="composePostView"] div[style^="margin-bottom: 20px"]:has(
        > div > button[aria-label="Remove attachment"]
    ),
    /* content warnings */
    button:is(
        [aria-label="Adult Content"],
        [aria-label="Sexually Suggestive"],
        [aria-label="Non-sexual Nudity"],
        [aria-label="Sexually Suggestive (Cartoon)"],
        [aria-label="Graphic Media"],
        [aria-label="Self-Harm"],
        [aria-label="Sensitive"],
        [aria-label="Extremist"],
        [aria-label="Intolerance"],
        [aria-label="Threats"],
        [aria-label="Rude"],
        [aria-label="Illicit"],
        [aria-label="Security Concerns"],
        [aria-label="Unsafe link"],
        [aria-label="Misinformation"],
        [aria-label="Scam"],
        [aria-label="Engagement Farming"],
        [aria-label="Spam"],
        [aria-label="Misleading"],
        [aria-label="Inauthentic Account"],
        [aria-label="Post Hidden by Muted Word"]
    ) > div[style^="flex-direction: row"] {
        border-width: 1px !important;
        border-radius: var(--tweak-radius);
        background: transparent !important;

        @container style(--tweak-option-small-link-previews: yes) {
            > div[style^="transition-property: color"]:has(> div[data-expoimage="true"]) {
                flex-direction: row !important;

                > div[data-expoimage="true"] {
                    flex: 0 0 25%;
                }
            }
        }

        &:hover {
            border-color: transparent !important;
            background: var(--tweak-fg-more-translucent) !important;
        }

        > div:only-child,
        > div[dir="auto"] {
            margin-top: 0 !important;
            border-radius: var(--tweak-radius) !important;
        }
    }

    /* top margin for URL cards */
    div:is(
        [data-testid='contentHider-post'],
        [data-testid^="postThreadItem-"]
    ) a[target="_blank"][aria-label] {
        margin-top: 8px;
    }

    /* reply/repost/like counts */
    :is(
        button[data-testid="replyBtn"],
        button[data-testid="repostBtn"],
        button[data-testid="likeBtn"]
    ) {
        div.css-146c3p1 {
            display: var(--tweak-option-count-display, flex) !important;
            transition-property: var(--tweak-transition-properties), color;
            color: var(--tweak-fg) !important;
        }

        @container style(--tweak-option-count-display: --on-hover) {
            &:not(:hover) div.css-146c3p1 {
                color: transparent !important;
            }
        }
    }

    /* thread lines */
    .r-m5arl1,
    div[style*="; width: 2px"] {
        background-color: var(--tweak-fg-more-translucent) !important;
    }

    /* nested reply lines */
    div[data-testid="postThreadScreen"] {
        /* var(--tweak-fg-more-translucent) won't work because of stacked lines */
        --thread-border-color: color-mix(in srgb, var(--tweak-fg) 25%, var(--tweak-bg)) !important;

        div[style*="border-right-width: 2px"] {
            border-color: var(--thread-border-color) !important;
            border-right-width: 2px !important;
        }
        div[style*="border-left-width: 2px"] {
            border-color: var(--thread-border-color) !important;
            border-left-width: 2px !important;
        }
        div[style*="border-bottom-width: 2px"] {
            border-color: var(--thread-border-color) !important;
            border-bottom-width: 2px !important;
        }
    }

    /* thread line ellipses */
    svg[width="4"]:has(> line + circle + circle + circle) {
        > line {
            stroke: var(--tweak-fg-more-translucent) !important;
        }

        > circle {
            fill: var(--tweak-fg-more-translucent) !important;
        }
    }

    /* reply bar at bottom on mobile */
    button[aria-label="Compose reply"] {
        background: var(--tweak-fg-more-translucent) !important;
        -webkit-backdrop-filter: var(--tweak-blur);
        backdrop-filter: var(--tweak-blur);
    }

    /* ----- !CONTEXT MENUS ----- */

    div[data-radix-popper-content-wrapper] {
        background: transparent !important;
        border-radius: var(--tweak-radius) !important;
    }

    /* styles for the menu itself */
    div[data-radix-menu-content] {
        transform-origin: top center;
        -webkit-backdrop-filter: var(--tweak-blur);
        backdrop-filter: var(--tweak-blur);
        animation: 125ms scale-up;
        background: var(--tweak-bg-translucent) !important;
        border-radius: var(--tweak-radius) !important;

        @media (prefers-reduced-transparency: reduce) {
            -webkit-backdrop-filter: none;
            backdrop-filter: none;
            background: var(--tweak-bg) !important;
        }

        @media (prefers-reduced-motion: reduce) {
            animation-name: fade-in;
        }

        :root.theme--dim & {
            border-width: 1px !important;
        }

        > div:only-child {
            border-radius: var(--tweak-radius) !important;
            box-shadow: var(--tweak-shadow) !important;
            background-color: transparent !important;
        }

        /* "Switch account" menu title and maybe others */
        div[dir="auto"]:first-child {
            color: var(--tweak-fg) !important;
            -webkit-user-select: none;
            user-select: none;
        }
    }

    /* menu items */
    div[role="menuitem"] {
        &:first-child {
            border-top-right-radius: var(--tweak-radius) !important;
            border-top-left-radius: var(--tweak-radius) !important;
        }
        &:last-child {
            border-bottom-right-radius: var(--tweak-radius) !important;
            border-bottom-left-radius: var(--tweak-radius) !important;
        }

        > div[dir="auto"] {
            color: var(--tweak-fg) !important;
            font-weight: 400 !important;
            font-size: 16px !important;
            -webkit-user-select: none;
            user-select: none;
        }

        path {
            fill: currentColor !important;
        }

        /* hover */
        &[style*="background-color"] {
            background: var(--tweak-bg-secondary) !important;
        }
    }

    /* dividers */
    div[role='separator'] {
        background: var(--tweak-fg-more-translucent) !important;
    }

    /* ----- !MODALS ----- */

    /* modals */
    /* TODO look for modals that aren't matched by this */
    div[role="dialog"]:not(:has(> div > div[data-testid="composePostView"])),
    div.r-rs99b7:has(> div[data-testid="composePostView"]),
    div.r-rs99b7:has(> div[data-testid="userAddRemoveListsModal"]) {
        margin: 0 20px !important;
        box-shadow: var(--tweak-shadow) !important;
        border-radius: var(--tweak-radius) !important;
        max-width: min(600px, calc(100vw - 40px)) !important;

        :root.theme--dim & {
            border-width: 1px !important;
        }
    }

    /* blurred backgrounds */
    /* hamburger menu */
    div[aria-label="Close drawer menu"],
    /* post composer and some other modals (ex. "Add to lists") */
    div:is(.r-17c3jg3, div[style*="background-color: rgba(0, 0, 0, 0.8)"]),
    /* some other modals */
    div[aria-label="Close active dialog"],
    /* image viewer */
    div.r-1xcajam:has(> button[aria-label="Close image viewer"]) {
        background: transparent !important;

        /* the pseudo-element works around a Safari issue */
        &::before {
            position: fixed;
            top: 0;
            left: 0;

            opacity: 1;
            -webkit-backdrop-filter: var(--tweak-blur) !important;
            backdrop-filter: var(--tweak-blur) !important;
            transition: opacity 250ms;
            /* animation: 250ms fade-in; */
            background: var(--tweak-bg-translucent) !important;
            width: 100%;
            height: 100%;
            pointer-events: none;
            content: '';
            @starting-style {
                opacity: 0;
            }

            @media (prefers-reduced-transparency: reduce) {
                -webkit-backdrop-filter: none !important;
                backdrop-filter: none !important;
                background: var(--tweak-bg-secondary) !important;
            }
        }

        div.r-1xcajam[style*="background-color: rgb(0, 0, 0)"] {
            background-color: transparent !important;
        }
    }

    /* ----- !POST COMPOSER ----- */

    /* vertically center */
    div[role="dialog"]:has(> div > div[data-testid='composePostView']) {
        justify-content: center;
    }

    /* fix Cancel button color */
    button[aria-label="Cancel"] > div.css-146c3p1 {
        color: var(--tweak-fg) !important;
    }

    /* post composer and alt text text fields */
    .ProseMirror p,
    textarea[aria-label="Alt text"] {
        color: var(--tweak-fg);
        text-transform: none !important;
    }

    /* links */
    .ProseMirror .autolink,
    /* usernames */
    .ProseMirror .mention {
        color: var(--tweak-accent);
    }

    /* username autocomplete popup */
    .tippy-box .items {
        box-shadow: var(--tweak-shadow);
        border-radius: var(--tweak-radius);
        overflow: hidden;

        :root.theme--dim & {
            border-width: 1px !important;
        }

        button.r-1otgn73 {
            background-color: transparent;
            border-radius: 8px !important;

            &[style*="background-color:"] {
                background-color: var(--tweak-accent) !important;

                div.r-1udbk01 {
                    color: var(--tweak-bg) !important;
                }
            }
        }
    }

    /* reply settings button */
    button[data-testid="openReplyGateButton"]:not(:hover) {
        background-color: transparent !important;
    }

    /* language picker */
    button[data-testid="selectLangBtn"]:hover {
        background-color: var(--tweak-fg-more-translucent) !important;
    }

    /* character count circle */
    div[data-testid='composePostView'] svg[width="30"][height="30"] path,
    /* alt text character count circle */
    div[aria-label="Add alt text"] svg[width="26"][height="26"] path {
        stroke: var(--tweak-accent) !important;
    }

    /* image buttons, remove attachment button */
    button[data-testid="altTextButton"],
    button[data-testid="editPhotoButton"],
    button[data-testid="removePhotoButton"],
    button[aria-label="Remove attachment"] {
        background: var(--tweak-fg) !important;
        box-shadow: var(--tweak-shadow);

        div[style^="color: "] {
            color: var(--tweak-bg) !important;
        }

        path {
            fill: var(--tweak-bg) !important;
        }
    }

    /* TODO reply settings hover and selected */
    /* div[aria-label="Edit post interaction settings"] :is(
        button[aria-checked="true"] > div,
        :root.theme--light div[style*="background-color: rgb(212, 219, 226)"],
        :root.theme--dim div[style*="background-color: rgb(46, 64, 82)"]
    ) {
        background: var(--tweak-accent) !important;

        > div {
            color: var(--tweak-bg) !important;
        }

        path {
            fill: var(--tweak-bg) !important;
        }
    } */

    /* ----- !IMAGES & VIDEO ----- */

    /* image background */
    div[data-expoimage="true"] img {
        background-color: var(--tweak-bg-secondary);
    }

    /* alt text indicator */
    div[style*="bottom: 4px; right: 4px;"] > div.css-146c3p1 {
        border-radius: 4px;
        background-color: var(--tweak-bg) !important;

        > div > div[dir="auto"] {
            color: var(--tweak-fg) !important;
        }
    }

    /* image viewer buttons */
    button[aria-label="Close image"],
    button[aria-label='Previous image'],
    button[aria-label='Next image'] {
        opacity: 0.5;
        -webkit-backdrop-filter: none !important;
        backdrop-filter: none !important;
        background: var(--tweak-bg-tertiary);
        transition: var(--tweak-transition-timing) !important;
        transition-property: background, opacity !important;

        @media (hover: hover) {
            opacity: 0;

            div.r-1xcajam:has(> button[aria-label="Close image viewer"]):hover & {
                opacity: 0.5;

                &:hover {
                    opacity: 1;
                }
            }
        }
    }

    /* move close button to left */
    div.r-1ki14p2:has(> div > button[aria-label="Close image"]) {
        right: auto !important;
        left: 10px;
    }

    /* remove transition from images */
    button[aria-label="Close image viewer"] > div.r-1pi2tsx:has(+ img) {
        transition: none !important;
    }

    /* alt text in image viewer */
    div.r-1fkl15p:has(> div[aria-label='Expand alt text']) {
        box-shadow: var(--tweak-shadow);
        background-color: var(--tweak-bg);
    }
    div[aria-label='Expand alt text'] > div[dir="auto"] {
        cursor: text;
        color: var(--tweak-fg) !important;
        -webkit-user-select: text;
        user-select: text;
        text-transform: none !important;
    }

    /* video player control colors */
    div[aria-label="Embedded video player"] {
        --contrast-color: var(--tweak-bg);
        :root.theme--dim & {
            --contrast-color: var(--tweak-fg);
        }

        /* player controls */
        path {
            fill: var(--contrast-color) !important;
        }

        /* elapsed time */
        div[style*="color: rgb(255, 255, 255)"] {
            color: var(--contrast-color) !important;
        }
    }

    /* scrubber */
    div[data-testid="scrubber"] > div > div:first-child {
        background-color: color-mix(in srgb, var(--contrast-color) 40%, transparent) !important;

        > div[style*="color: rgb(255, 255, 255)"] {
            background-color: var(--contrast-color) !important;
        }
    }
    /* knob */
    div[role="slider"] > div[style*="transform: scale(0.6)"] {
        background-color: var(--contrast-color) !important;
        transform: scale(1) !important;
    }

    /* volume slider */
    input[aria-label="Volume"] {
        background-color: transparent !important;
        accent-color: var(--contrast-color) !important;

        &::-webkit-slider-thumb,
        &::-webkit-slider-runnable-track {
            background-color: var(--contrast-color) !important;
        }
    }

    /* ----- !NOTIFICATIONS ----- */

    div[data-testid="notifsFeed"] {
        /* notification spacing */
        div.r-q5xsgd > div:has(> :is(a, div)[data-testid^="feedItem-by-"]) {
            margin: 8px 8px 0 !important;
            border-radius: var(--tweak-radius);
            overflow: hidden;
        }

        /* highlight new notifications */
        a[data-testid^="feedItem-by-"][style*="background-color"],
        div[data-testid^="feedItem-by-"] > div[style*="background-color"] {
            background: var(--tweak-accent-more-translucent) !important;
        }

        /* disable hover highlight */
        a[data-testid^='feedItem-by-'] > div:first-child:empty {
            background-color: transparent !important;
        }

        /* disable hand cursor on notification body */
        a[data-testid^='feedItem-by-'].r-1otgn73 {
            cursor: default !important;
        }
        /* restore on images */
        div[data-expoimage="true"] {
            cursor: pointer;
        }
    }


    /* ----- !PROFILE ----- */

    /* back button */
    button[data-testid="profileHeaderBackBtn"] {
        > div[style^="align-items: center"] {
            background: var(--tweak-bg) !important;

            &:hover {
                background: var(--tweak-bg-secondary) !important;
            }
        }

        path {
            fill: var(--tweak-fg) !important;
        }
    }

    /* restore profile pic border */
    div[data-testid="profileHeaderAviButton"] {
        border: 2px solid var(--tweak-bg) !important;
    }

    /* hand cursor for profile pic */
    div[data-testid="userAvatarImage"] {
        cursor: pointer;
    }

    /* follow button (also applies to post pages) */
    button[data-testid="followBtn"] > div[dir="auto"] {
        color: var(--tweak-bg) !important;
    }

    /* Similar accounts box */
    div[data-testid="profileView"] div.r-12vffkv {
        border-radius: var(--tweak-radius);
    }
    button[aria-label="Follow"] > div[style*="color: rgb(255, 255, 255)"] {
        color: var(--tweak-bg) !important;
    }

    /* ----- !CHATS ----- */

    /* restore hand cursor on settings button */
    a[href="/messages/settings"] {
        cursor: pointer;
    }

    /* chat requests banner */
    a[aria-label="Chat request inbox"] {
        background-color: var(--tweak-bg-secondary) !important;
        border-radius: var(--tweak-radius) !important;
        cursor: pointer !important;
    }

    /* chats list */
    a[href^="/messages/"] {
        cursor: default;

        > div[style*="background-color:"] {
            background-color: transparent !important;
        }
    }

    /* placeholder for missing avatars */
    svg[data-testid="userAvatarFallback"] {
        circle[fill="#0070ff"] {
            fill: var(--tweak-fg) !important;
        }
        :is(circle, path)[fill="#fff"] {
            fill: var(--tweak-bg) !important;
        }
    }

    /* message bubbles */
    div[data-testid="convoScreen"] div[style^="padding: 8px 14px"]:has(> div[data-word-wrap="1"]) {
        /* incoming */
        &[style*="align-self: flex-start"] {
            background-color: var(--tweak-bg-secondary) !important;

            > div, a {
                color: var(--tweak-fg) !important;
            }
        }

        /* sent */
        &[style*="align-self: flex-end"] {
            background-color: var(--tweak-fg) !important;

            > div, a {
                color: var(--tweak-bg) !important;
            }
        }
    }

    /* message text field */
    div[style*="height: 44px;"]:has(> textarea[placeholder="Write a message"]) {
        align-items: center;
        background-color: var(--tweak-fg-more-translucent) !important;

        > button[aria-label="Open emoji picker"],
        > textarea[placeholder="Write a message"],
        > button[aria-label="Send message"] {
            margin-top: 0 !important;
            padding-block: 0 !important;
            resize: none !important;
        }
    }

    /* send button */
    button[aria-label="Send message"] {
        background-color: var(--tweak-accent) !important;

        path {
            fill: var(--tweak-bg) !important;
        }
    }

    /* remove gap under message text field  */
    div[style^="transform: translateY"]:has(textarea[placeholder="Write a message"]) {
        transform: none !important;
    }

    /* ----- !SETTINGS ----- */

    /* TODO */
}
